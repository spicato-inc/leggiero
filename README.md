# Syuku 『縮』

**Syuku 『縮』** は Node.js 用の画像圧縮ツールです。
`sharp` を利用して JPEG, PNG, GIF などの画像を圧縮し、出力先ディレクトリに同じディレクトリ構造で保存します。また、WEBP 形式への変換も対応しています（ただし、ファイル名に「no-webp」が含まれている場合は変換をスキップします）。
SVG は複製のみ行います。

## 特徴

- **all モード**
  指定したソースディレクトリ内の全画像を再帰的に処理し、圧縮した画像を出力先に保存します。

- **watch モード**
  ソースディレクトリ内のファイル変更を監視し、変更された画像のみを即時圧縮します。
  （`onchange` 経由で変更を検知します）

- ソースディレクトリと同じディレクトリ構造を出力先に再現

## インストール

このパッケージをインストールすると必要な依存パッケージ（sharp, onchange）は自動的にインストールされます。
グローバルインストール例:

```bash
npm install -g @spicato-inc/syuku
```

## 使い方

シンボリックリンクなどでグローバルコマンドとして利用可能です。

### 圧縮 (all モード)

ディレクトリ内の全画像を圧縮して出力先に保存します。
出力先を指定しない場合は `public` が使用されます。

```bash
syuku all <source-directory> [dest-directory]
```

例:

```bash
syuku all src/assets/images public
```

### 監視 (watch モード)

指定したソースディレクトリの画像変更を監視し、自動で圧縮処理を実行します。
出力先を指定しない場合は `public` が使用されます。

```bash
syuku watch <source-directory> [dest-directory]
```

例:

```bash
syuku watch src/assets/images public
```

## 動作の流れ

1. **all モード**

   - ソースディレクトリを再帰的に探索し、各画像の相対パスをもとに出力先ディレクトリを決定。
   - 画像を圧縮または複製（SVG）し、WEBP 変換も行います（例外: ファイル名に「no-webp」が含まれる場合）。

2. **watch モード**
   - `npx onchange` 経由でファイル変更を検知し、変更されたファイル毎に圧縮処理を実行。
   - 変更されたファイルの出力先は、元のパス中の "src" を指定した出力先に置換して決定します。

## 注意事項

- 出力先ディレクトリが存在しない場合、自動的に再帰的に作成します。
- 圧縮処理に失敗すると、エラーメッセージが出力され、処理はスキップされます。
- `no-webp` が含まれるファイル名の場合、WEBP 変換は実行されません。

## ライセンス

MIT License
© spicato inc.
